import { Meta, Source, Story } from '@storybook/blocks';
import * as FormStories from './Form.stories';

<Meta of={FormStories} />

# BasicControl
<Story of={FormStories.BasicControl} />
<Source of={FormStories.BasicControl} language="tsx" code={`
import { FormGroup, FormBuilder } from '@hubfx/forms';
import { Form, FormBuilder } from '@hubfx/react-forms';

const MyForm = () => {
  const formConfig = FormBuilder.control({
    initialValue: 'john',
  });

  return (
    <Form formConfig={formConfig}>
      {({ state }) => {
        return (
          <>
            <Field controlRef={[]} component={Input} />
            <div>
              First Name: <span>{state.value as string}</span>
            </div>
          </>
        );
      }}
    </Form>
  );
};`}/>

# Validation
<Story of={FormStories.Validation} />
<Source of={FormStories.Validation} language="tsx" code={`
import { Form, FormBuilder, Validators } from '@hubfx/react-forms';

const MyForm = () => {
  const formConfig = FormBuilder.group({
    controls: {
      firstName: FormBuilder.control({
        initialValue: 'John',
        validators: [Validators.required],
      }),
      lastName: FormBuilder.control({
        initialValue: '',
        validators: [Validators.required],
      }),
    },
  });

  return (
    <Form
      formConfig={formConfig}
    >
      {() => {
        return (
          <div className="form-group">
            <Field
              controlRef={['firstName']}
              component={Input}
              label="First Name (required)"
            />
            <Field
              controlRef={['lastName']}
              component={Input}
              label="Last Name (required)"
            />
          </div>
        );
      }}
    </Form>
  );
};`}/>

# Async Validation
<Story of={FormStories.AsyncValidation} />
<Source of={FormStories.AsyncValidation} language="tsx" code={`
import { Form, FormBuilder, Validators, ValidatorAsyncFn } from '@hubfx/react-forms';
import { of } from 'rxjs';
import { mergeMap, delay, debounceTime } from 'rxjs/operators';

const blacklistedEmail: ValidatorAsyncFn = (control$) => {
  const blacklisted = ['not@allowed.com'];

  return control$.pipe(
    debounceTime(500),
    mergeMap((control) => {
      return of({
        blacklistedEmail: blacklisted.includes(control.value as string),
      }).pipe(delay(1000));
    }),
  );
};

const contactFormConfig = ({ firstName, lastName, email }) =>
  FormBuilder.group({
    controls: {
      firstName: FormBuilder.control({
        initialValue: firstName,
        validators: [Validators.required],
      }),
      lastName: FormBuilder.control({
        initialValue: lastName,
        validators: [Validators.required],
      }),
      email: FormBuilder.control({
        initialValue: email,
        validators: [Validators.required, Validators.email],
        asyncValidators: [blacklistedEmail],
      }),
    },
  });

const MyForm = () => {
  return (
    <Form
      formConfig={contactFormConfig({
        firstName: 'John',
        lastName: 'Doe',
        email: '',
      })}
    >
      {() => 
        <div className="form-group">
          <Field
            controlRef={['firstName']}
            component={Input}
            label="First Name"
          />
          <Field
            controlRef={['lastName']}
            component={Input}
            label="Last Name"
          />
          <Field
            controlRef={['email']}
            component={Input}
            label={
              <span>
                Email <i>(not@allowed.com is blacklisted)</i>
              </span>
            }
          />
        </div>
      }
    </Form>
  );
};`}/>

# Async Validation
<Story of={FormStories.AsyncValidation} />
<Source of={FormStories.AsyncValidation} language="tsx" code={`
import { Form, FormBuilder, Validators, ValidatorAsyncFn } from '@hubfx/react-forms';
import { of } from 'rxjs';
import { mergeMap, delay, debounceTime } from 'rxjs/operators';

const blacklistedEmail: ValidatorAsyncFn = (control$) => {
  const blacklisted = ['not@allowed.com'];

  return control$.pipe(
    debounceTime(500),
    mergeMap((control) => {
      return of({
        blacklistedEmail: blacklisted.includes(control.value as string),
      }).pipe(delay(1000));
    }),
  );
};

const contactFormConfig = ({ firstName, lastName, email }) =>
  FormBuilder.group({
    controls: {
      firstName: FormBuilder.control({
        initialValue: firstName,
        validators: [Validators.required],
      }),
      lastName: FormBuilder.control({
        initialValue: lastName,
        validators: [Validators.required],
      }),
      email: FormBuilder.control({
        initialValue: email,
        validators: [Validators.required, Validators.email],
        asyncValidators: [blacklistedEmail],
      }),
    },
  });

const MyForm = () => {
  return (
    <Form
      formConfig={contactFormConfig({
        firstName: 'John',
        lastName: 'Doe',
        email: '',
      })}
    >
      {() => 
        <div className="form-group">
          <Field
            controlRef={['firstName']}
            component={Input}
            label="First Name"
          />
          <Field
            controlRef={['lastName']}
            component={Input}
            label="Last Name"
          />
          <Field
            controlRef={['email']}
            component={Input}
            label={
              <span>
                Email <i>(not@allowed.com is blacklisted)</i>
              </span>
            }
          />
        </div>
      }
    </Form>
  );
};`}/>